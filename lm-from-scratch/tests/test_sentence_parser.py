import re
from lm_from_scratch.corpus.decision_corpus import SENTENCE_DELIMITER, DecisionCorpus


def test_toto():
    sample_text = "N° Y 23-80.751 F-B\n \n N° 01181\n \n \n RB5\n 17 OCTOBRE 2023\n \n \n CASSATION PARTIELLE\n \n \n M. BONNAL président,\n \n \n \n \n \n \n \n \n R É P U B L I Q U E F R A N Ç A I S E\n ________________________________________\n \n \n AU NOM DU PEUPLE FRANÇAIS\n _________________________\n \n \n ARRÊT DE LA COUR DE CASSATION, CHAMBRE CRIMINELLE, \n DU 17 OCTOBRE 2023\n \n \n \n M. [E] [I] a formé un pourvoi contre l'arrêt de la cour d'appel d'Orléans, chambre correctionnelle, en date du 24 janvier 2023, qui, pour harcèlement moral, l'a condamné à un an d'emprisonnement avec sursis, 5 000 euros d'amende, cinq ans d'interdiction d'exercer une fonction publique, deux ans d'inéligibilité, et a prononcé sur les intérêts civils. \n \n Un mémoire a été produit.\n \n Sur le rapport de M. Maziau, conseiller, les observations de la SCP Fabiani, Luc-Thaler et Pinatel, avocat de M. [E] [I], et les conclusions de M. Lagauche, avocat général, après débats en l'audience publique du 19 septembre 2023 où étaient présents M. Bonnal, président, M. Maziau, conseiller rapporteur, Mme Labrousse, conseiller de la chambre, et Mme Boudalia, greffier de chambre,\n \n la chambre criminelle de la Cour de cassation, composée en application de l'article 567-1-1 du code de procédure pénale, des président et conseillers précités, après en avoir délibéré conformément à la loi, a rendu le présent arrêt.\n Faits et procédure\n \n 1. Il résulte de l'arrêt attaqué et des pièces de procédure ce qui suit.\n \n 2. Le 13 avril 2018, MM. [K] [B] et [J] [D] ont déposé plainte à l'encontre de M. [E] [I] du chef de harcèlement moral commis dans le cadre de ses fonctions de président d'université.\n \n 3. Une enquête préliminaire a été ouverte. Au terme de celle-ci, M. [I] a été cité devant le tribunal correctionnel du chef susvisé. \n \n 4. MM. [B] et [D] se sont constitués partie civile. \n \n 5. Par jugement du 20 janvier 2022, le tribunal correctionnel a relaxé M. [I] des faits reprochés. \n \n 6. Les parties civiles ont interjeté appel. Le ministère public a interjeté appel incident. \n \n Examen des moyens\n \n Sur les premier et deuxième moyens\n \n 7. Ils ne sont pas de nature à permettre l'admission du pourvoi au sens de l'article 567-1-1 du code de procédure pénale.\n \n Mais sur le moyen relevé d'office et mis dans le débat\n \n Vu les articles 111-3 et 131-27, dernier alinéa, du code pénal :\n \n 8. Selon le premier de ces textes, nul ne peut être puni d'une peine qui n'est pas prévue par la loi.\n \n 9. Selon le second, l'interdiction d'exercer une fonction publique ou d'exercer une activité professionnelle ou sociale n'est pas applicable à l'exercice d'un mandat électif, de responsabilités syndicales ou en matière de délit de presse. \n \n 10. Après avoir déclaré M. [I] coupable du chef de harcèlement moral, l'arrêt attaqué l'a condamné, notamment, à l'interdiction de diriger une quelconque institution universitaire pendant une durée de cinq ans.\n \n 11. En prononçant ainsi une interdiction de diriger une institution universitaire alors qu'il résulte de l'article L. 712-2, alinéa 1er, du code de l'éducation, que l'exercice de la fonction de président d'université repose sur un mandat électif, la cour d'appel a méconnu les textes susvisés et les principes ci-dessus rappelés. \n \n 12. La cassation est encourue de ce chef. \n \n Et sur le quatrième moyen\n \n Enoncé du moyen\n \n 13. Le moyen critique l'arrêt infirmatif attaqué en ce qu'il a condamné M. [I] à payer 5 000 euros à M. [B] à titre de dommages et intérêts et 10 000 euros à M. [D] à titre de dommages et intérêts, alors : \n \n « 1°/ que les tribunaux répressifs de l'ordre judiciaire sont incompétents pour statuer sur la responsabilité d'une administration ou d'un service public en raison d'un fait dommageable commis par l'un de leurs agents ; que l'agent d'un service public n'est personnellement responsable des conséquences dommageables de l'acte délictueux qu'il a commis que si celui-ci constitue une faute détachable de ses fonctions ; qu'en condamnant M. [I] qui a agi dans le cadre de ses fonctions de président de l'université de [Localité 1] à indemniser les parties civiles, sans rechercher si la faute imputée à celui-ci présentait le caractère d'une faute personnelle détachable du service, la cour d'appel a violé la loi des 16-24 août 1790 et le décret du 16 fructidor an III, outre le principe relatif à la dualité des ordres juridictionnels. »\n \n Réponse de la Cour\n \n Vu la loi des 16-24 août 1790 et le décret du 16 fructidor an III :\n \n 14. Il résulte de ces textes que les tribunaux répressifs de l'ordre judiciaire sont incompétents pour statuer sur la responsabilité d'une administration ou d'un service public en raison d'un fait dommageable commis par l'un de leurs agents et que l'agent d'un service public n'est personnellement responsable des conséquences dommageables de l'acte délictueux qu'il a commis que si celui-ci constitue une faute détachable de ses fonctions.\n \n 15. En l'espèce, après avoir déclaré M. [I] coupable de harcèlement moral, l'arrêt le condamne à verser des dommages-intérêts aux parties civiles en retenant que les faits reprochés engagent sa responsabilité civile et l'obligent, par application de l'article 1240 du code civil, à en réparer les conséquences dommageables dont il est entièrement responsable. \n \n 16. En se reconnaissant ainsi compétente pour statuer sur la responsabilité civile du prévenu, président d'université ayant agi dans l'exercice de ses fonctions, sans rechercher si la faute imputée à celui-ci présentait le caractère d'une faute personnelle détachable du service, la cour d'appel a méconnu les textes susvisés et le principe ci-dessus rappelé. \n \n \n 17. En outre, il n'importe que M. [I] n'ait pas opposé devant les juges du fond l'exception dont il pouvait se prévaloir, l'incompétence des juridictions étant en pareil cas d'ordre public. \n \n 18. La cassation est de nouveau encourue de ce chef sans qu'il y ait lieu d'examiner le second grief. \n \n Portée et conséquence de la cassation \n \n 19. La cassation à intervenir ne concerne que les dispositions relatives aux peines et aux intérêts civils prononcés à l'encontre de M. [I], les dispositions sur la culpabilité sont définitives.\n \n PAR CES MOTIFS, et sans qu'il y ait lieu d'examiner le troisième moyen de cassation proposé, la Cour :\n \n CASSE et ANNULE l'arrêt susvisé de la cour d'appel d'Orléans, en date du 24 janvier 2023, mais en ses seules dispositions relatives aux peines et aux intérêts civils, toutes autres dispositions étant expressément maintenues ;\n \n Et pour qu'il soit à nouveau jugé, conformément à la loi, dans les limites de la cassation ainsi prononcée,\n \n RENVOIE la cause et les parties devant la cour d'appel d'Angers, à ce désignée par délibération spéciale prise en chambre du conseil ;\n \n ORDONNE l'impression du présent arrêt, sa transcription sur les registres du greffe de la cour d'appel d'Orléans et sa mention en marge ou à la suite de l'arrêt partiellement annulé ;\n \n Ainsi fait et jugé par la Cour de cassation, chambre criminelle, et prononcé par le président en son audience publique du dix-sept octobre deux mille vingt-trois."

    corpus = DecisionCorpus()
    texts = corpus.get_text()
    sample_text = texts[9589]

    cuts = [0]
    for match in re.finditer(SENTENCE_DELIMITER, sample_text):
        cut = match.regs[0][1]
        if cut - cuts[-1] > 20:
            cuts.append(cut)

    cuts += [len(sample_text)]

    sentence_pairs = []
    for i in range(2, len(cuts)):
        first_sentence = sample_text[cuts[i - 2] : cuts[i - 1]]
        second_sentence = sample_text[cuts[i - 1] : cuts[i]]

        sentence_pairs.append((first_sentence, second_sentence))

    assert len(sentence_pairs) == 29
